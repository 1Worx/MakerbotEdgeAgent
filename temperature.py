import operator 
import requests


info = [' , "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0", "method": "system_notification"}{"params": {"info": {"has_been_connected_to": true, "toolheads": {'
,
' ": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}, "jsonrpc": "2.0", "id": 2}{"params": {"info": {'
,
' ed_time": 6473, "reason": null, "print_temperatures": {"0":215, "1": 0}, "filament_extruded": 18, "extrusion_distance_mm": 12120, "time_remaining": 5779, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g":36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0", "method": "system_notification"}{"params": {"info": {"has_been_connected_to": true, "toolheads": {'
,
' "api_version": "1.4.0", "current_process": {"name": "PrintProcess", "time_estimation": 12253, "username": "1worx", "methods": ["unload_filament", "suspend", "load_filament"], "error": null, "elapsed_time": 6476, "reason": null, "print_temperatures": {"0": 215, "1": 0}, "filament_extruded": 18, "extrusion_distance_mm": 12120, "time_remaining": 5776, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}'
,
' ue, "filament_presence": true, "tool_id": 1}]}, "firmware_version": {"bugfix": 1, "minor": 7, "build": 305, "major": 1}, "sound": true, "disabled_errors": [], "bot_type": "replicator_5", "api_version": "1.4.0", "current_process": {"name": "PrintProcess", "time_estimation": 12253, "username": "1worx", "methods": ["unload_filament", "suspend", "load_filament"], "error": null, "elapsed_time": 6480, "reason": null, "print_temperatures": {'
,
'as_been_connected_to": true, "toolheads": {"extruder": [{"preheating": true, "target_temperature": 215, "current_temperature": 216, "index": 0, "tool_present": true, "filament_presence": true, "tool_id": 1}]}'
,
' ": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0", "method": "system_notification"}{"result": {"has_been_connected_to": true, "toolheads": {"extruder": [{'
,
' 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36,"complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0", "method": "system_notification"}{"params": {"info": {"has_been_connected_to": true, "toolheads": {'
,
' ": 215, "1": 0}, "filament_extruded": 18, "extrusion_distance_mm": 12120, "time_remaining": 5764, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}, "jsonrpc": "2.0", "id": 6}{"params": {"info": {"has_been_connected_to": true, "toolheads": {'
,
' on": 12253, "username": "1worx", "methods": ["unload_filament", "suspend", "load_filament"], "error": null, "elapsed_time": 6489, "reason":null, "print_temperatures": {"0": 215, "1": 0}, "filament_extruded": 18, "extrusion_distance_mm": 12120, "time_remaining": 5763, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0", "method": "system_notification"}{"params": {"info": {"has_been_connected_to": true, "toolheads": {'
,
' "minor": 7, "build": 305, "major": 1}, "sound": true, "disabled_errors": [], "bot_type": "replicator_5", "api_version": "1.4.0", "current_process": {"name": "PrintProcess", "time_estimation": 12253, "username": "1worx","methods": ["unload_filament", "suspend", "load_filament"], "error": null, "elapsed_time": 6491, "reason": null, "print_temperatures": {"0": 215, "1": 0}'
,
' ue, "target_temperature": 215, "current_temperature": 216, "index": 0, "tool_present": true, "filament_presence": true, "tool_id": 1}]}, "firmware_version": {"bugfix": 1, "minor": 7, "build": 305, "major": 1}, "sound": true, "disabled_errors": [], "bot_type": "replicator_5", "api_version": "1.4.0","current_process": {"name": "PrintProcess", "time_estimation": 12253, "username": "1worx", "methods": ["unload_filament", "suspend", "load_filament"], "error":null, "elapsed_time": 6494, "reason": null, "print_temperatures": {'
,
' "machine_name": "MakerBot Replicator"}, "jsonrpc": "2.0", "id": 8}{"params": {'
,
' me": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0", "method": "system_notification"}{"result": {"has_been_connected_to": true, "toolheads": {"extruder": [{'
,
' "time_remaining": 5754, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0", "method": "system_notification"}{"params": {"info": {"has_been_connected_to": true, "toolheads": {'
,
' ment", "suspend", "load_filament"], "error": null, "elapsed_time": 6500, "reason": null, "print_temperatures": {"0": 215, "1": 0}, "filament_extruded": 18, "extrusion_distance_mm": 12120, "time_remaining": 5752, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false,"id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}, "jsonrpc": "2.0", "id": 10}{"params": {"info": {'
,
'  [], "bot_type": "replicator_5", "api_version": "1.4.0", "current_process": {"name": "PrintProcess", "time_estimation": 12253, "username": "1worx", "methods": ["unload_filament", "suspend", "load_filament"], "error": null, "elapsed_time": 6503, "reason": null, "print_temperatures": {"0": 215, "1": 0}, "filament_extruded": 18, "extrusion_distance_mm": 12120, "time_remaining": 5749, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}'
,
' sent": true, "filament_presence": true, "tool_id": 1}]}, "firmware_version": {"bugfix": 1, "minor": 7, "build": 305, "major": 1}, "sound": true, "disabled_errors": [], "bot_type": "replicator_5", "api_version": "1.4.0","current_process": {"name": "PrintProcess", "time_estimation": 12253, "username": "1worx", "methods": ["unload_filament", "suspend", "load_filament"], "error":null, "elapsed_time": 6505, "reason": null, "print_temperatures": {'
,
' ystem_notification"}{"params": {"info": {"has_been_connected_to": true, "toolheads": {"extruder": [{"preheating": true, "target_temperature": 215, "current_temperature": 214, "index": 0, "tool_present": true, "filament_presence": true, "tool_id": 1}]}, "firmware_version": {"bugfix": 1, "minor": 7, "build": 305, "major": 1}, "sound": true, "disabled_errors": [], "bot_type": "replicator_5", "api_version": "1.4.0", "current_process": {"name": "PrintProcess","time_estimation": 12253, "username": "1worx", "methods": ["unload_filament", "suspend", "load_filament"], "error": null, "elapsed_time": 6508, "reason": null,"print_temperatures": {"0": 215, "1": 0}, "filament_extruded": 18, "extrusion_distance_mm": 12120, "time_remaining": 5744, "can_print_again": true, "filepath":"/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}'
,
'  "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0", "method": "system_notification"}{"params": {"info": {"has_been_connected_to": true, "toolheads": {'
,
' ning": 5740, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0","method": "system_notification"}{"params": {"info": {"has_been_connected_to": true, "toolheads": {'
,
' t", "suspend", "load_filament"], "error": null, "elapsed_time": 6515, "reason": null, "print_temperatures": {"0": 215, "1": 0}, "filament_extruded": 18, "extrusion_distance_mm": 12120, "time_remaining": 5737, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}, "ip": "192.168.11.6", "machine_type": "platypus", "machine_name": "MakerBot Replicator"}}, "jsonrpc": "2.0", "method": "system_notification"}{"params": {"info": {"has_been_connected_to": true, "toolheads": {'
,
' e, "disabled_errors": [], "bot_type": "replicator_5", "api_version": "1.4.0", "current_process": {"name": "PrintProcess", "time_estimation": 12253, "username": "1worx", "methods": ["unload_filament", "suspend", "load_filament"], "error": null, "elapsed_time": 6518, "reason": null, "print_temperatures": {"0": 215, "1": 0}, "filament_extruded": 18, "extrusion_distance_mm": 12120, "time_remaining": 5734, "can_print_again": true, "filepath": "/home/current_thing/Laurana.makerbot", "thing_id": 0, "progress": 52, "step": "printing", "start_time": "13:21:0 10/30/2015", "cancelled": false, "cancellable": true, "extrusion_mass_g": 36, "complete": false, "id": 1}'
,
' 215, "current_temperature": 214, "index": 0, "tool_present": true, "filament_presence": true, "tool_id": 1}]}, "firmware_version": {"bugfix": 1, "minor": 7, "build": 305, "major": 1}, "sound": true, "disabled_errors": [], "bot_type": "replicator_5", "api_version": "1.4.0", "current_process": {"name": "PrintProcess", "time_estimation": 12253, "username": "1worx", "methods": ["unload_filament", "suspend", "load_filament"], "error": null, "elapsed_time": 6521, "reason": null, "print_temperatures": {'
]

# pip install requests
def send_temperature(t)
	payload = {'value': t,'appKey':'1CB45438-C0B7-4812-B95C-892762FDA0CC'}
	headers = {'content-type':  'application/json; charset=utf8'}
	r = requests.put('http://localhost/Thingworx/Things/remotetest/Properties/Temperature', data =payload, headers=headers)
	print r.status_code
	
def extract_temperature(response, token):	
	#response = self.rpc_socket.recv(2048)	
	temperature = 'not found'
	if token in response:
		a = response.index(token)
		response = response[a+len(token):]
		b=0
		try:
			b = response.index(',')
		except:
			return 'b index' #temperature #return extract_temperature(self,response, token):
		temperature = response[:b]		
	return temperature
	
def get_temperature():
	temperature  = 'not found'
	#response = self.rpc_socket.recv(2048)
	token = '"current_temperature":'
	for response in info:
		temperature  = extract_temperature(response, token)
		if (temperature == 'not found'): #try again
			#response = self.rpc_socket.recv(2048)
			temperature  = extract_temperature(response, token)
		print temperature
		
print 'start'
t = get_temperature()
#send_temperature(t)